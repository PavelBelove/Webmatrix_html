# Задача

    - добавить в webmatrix.html чат с использованием gemini API.
    - Но файл WebMatrix.html стал слишком большим, ты не можешь без ошибок править его поэтому создать отдельный файл chat.html
    - в этом файле chat.html написать простой чат с использованием gemini API, но используя те же стили, которые ты делал в WebMatrix.html.
    - Пиши так, чтобы можно было взять секцию chat.html и вставить в webmatrix.html не меняя структуру и не меняя стили. Просто скопировав HTML и код, и вставив в нужное место.
    - Для имитации фзаимодействия с другими секциями сделай "эмуляторы" элементов с теми же названиями, но без функционала.

# Что должен уметь чат:

- Использует тот же апи ключ, что и другие секции.
- В обычном режиме спрятан под спойлером, как секция cettings и readme.
- Настройки чата вверху секции, тоже под спойлером (по аналогии с АПИ настройками в settings).
- В настройках есть модуль управления системными промптами (по аналогии с пресетами в settings). Можно написать промпт, загрузить из txt или md файла. Сохранить в localstorage, или загрузить из него. Скачать в md формате активный промпт (имя - как имя сохраненного промпта).
- Есть 2 "галочки" в настройках: LLM видит таблицу (загруженные данные из интерфейса) и LLM видит пресет (промпт и колонки, активные в интерфейсе). Чтобы аналитик мог легко обсудить настройки промпта вебматрикс, или попросить проанализировать результаты и ответить по ним. Если обе галочки сняты, то это обычный чат с llm с возможностью задать промпт.
- Мы храним в localstorage: 1) Сохраненные промпты. 2) История чата. Скажем, последние 100 сообщений.
- Но как контекст для LLM мы посылаем последние 10 сообщений, только тексты ответов и вопросов. А таблицу с данными или пресет - скидываем строго 1 раз, вместе с последним вопросом пользователя.
- Секция чата имеет высоту в экран, диалог в отдельном блоке, со своей прокруткой. Ввод под ним.
- Есть кнопка отправить сообщение, которая отправляет последнее сообщение в чат вместе с таблицей или пресетом, в зависимости от "галочек" в настройках. Так же, сообщения отправляются при нажатии энтер, перевод строки - контрол энтер и(или) шифт энтер
- Есть очистка истории чата, но в настройках, чтобы не ткнуть случайно.

# Ограничения и условия:

- Концепт webmatrix - ультра легкость и портативность.
- Все данные, которые нужны для работы чата должны храниться локально, в localstorage.
- Мы не используем библиотеки, которые потребуют дополнительной установки у пользователя - только стандартные браузерные средства.
- Секция чата делается для того, чтобы потом вставить ее в webmatrix.html, не меняя структуру и не меняя стили.

# Основные требования

## Интеграция
- Использует тот же API ключ, что и основной интерфейс
- Должен легко встраиваться в WebMatrix.html без изменения существующего кода
- Использует те же стили для консистентности интерфейса

## Интерфейс
- Секция чата спрятана под спойлером (аналогично settings/readme)
- Настройки чата вверху секции, тоже под спойлером
- Высота секции равна высоте экрана
- Диалог в отдельном блоке со своей прокруткой
- Поле ввода под блоком диалога

## Функциональность
- Отправка сообщений:
  - Кнопкой "Отправить"
  - Enter для отправки
  - Shift+Enter или Ctrl+Enter для новой строки
- Загрузка файлов:
  - Кнопка рядом с "Отправить"
  - Drag-and-drop файлов в чат
- Поддержка Markdown:
  - Форматирование текста
  - Отображение таблиц
  - Подсветка кода

## Настройки
- Управление системными промптами:
  - Создание/редактирование промптов
  - Загрузка из txt/md файлов
  - Сохранение в localStorage
  - Выгрузка активного промпта в md
- Чекбоксы для контекста:
  - "LLM видит таблицу"
  - "LLM видит пресет"
- Очистка истории чата

## Хранение данных
- В localStorage хранятся:
  - Сохраненные промпты
  - История чата (последние 100 сообщений)
- Контекст для LLM:
  - Последние 10 сообщений
  - Таблица/пресет отправляются один раз с последним вопросом

# Технические ограничения
- Только стандартные браузерные средства
- Все данные хранятся локально
- Минимальный размер кода
- Максимальная портативность

# Цель
Вспомогательный инструмент для:
- Быстрого улучшения промптов
- Анализа данных с помощью LLM
- Обсуждения настроек и результатов
- Любых быстрых обсуждений с LLM.